{% extends 'base.html' %}
{% load static %}

{% block content %}
<main class="main">
  <div class="cover-home1">
    <div class="container">
      <div class="row">
        <div class="col-xl-1"></div>
        <div class="col-xl-10 col-lg-12">

          <!-- BANNER -->
          <div class="banner">
            <div class="row align-items-center">
              <div class="col-lg-12 text-center pt-100">
                <span class="text-sm-bold color-gray-600">
                  Assalomu alaykum!
                </span>

                <h1 class="color-gray-50 mt-20 mb-20">
                  Iâ€™m
                  <a class="typewrite color-linear"
                     href="#"
                     data-period="2500"
                     data-type='[
                       "Abduazim Qudratullaev",
                       "Backend Developer",
                       "student of Najot Ta`lim"
                     ]'>
                    <span class="wrap"></span>
                  </a>
                </h1>

                <div class="row justify-content-center">
                  <div class="col-lg-8">
                    <p class="text-base color-gray-600">
                      Men zamonaviy va xavfsiz backend tizimlar yaratish bilan shug'ullanaman.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</main>

<!-- ================= JS TYPEWRITER + VOICE ================= -->
<script>
class TypeWriter {
  constructor(el, words, period) {
    this.el = el;
    this.words = words;
    this.period = period;
    this.txt = '';
    this.wordIndex = 0;
    this.isDeleting = false;
    this.spoken = false;
    this.type();
  }

  type() {
    const current = this.wordIndex % this.words.length;
    const fullTxt = this.words[current];

    if (this.isDeleting) {
      this.txt = fullTxt.substring(0, this.txt.length - 1);
    } else {
      this.txt = fullTxt.substring(0, this.txt.length + 1);
    }

    this.el.querySelector(".wrap").innerHTML = this.txt;

    let speed = 120;

    if (!this.isDeleting && this.txt === fullTxt) {
      if (!this.spoken) {
        speak(fullTxt);
        this.spoken = true;
      }
      speed = this.period;
      this.isDeleting = true;
    }
    else if (this.isDeleting && this.txt === '') {
      this.isDeleting = false;
      this.spoken = false;
      this.wordIndex++;
      speed = 500;
    }

    setTimeout(() => this.type(), speed);
  }
}

// VOICE FUNCTION
function speak(text) {
  if (!window.speechSynthesis) return;

  speechSynthesis.cancel();

  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "en-US";      // eng toza talaffuz
  msg.rate = 0.9;
  msg.pitch = 1;
  msg.volume = 1;

  speechSynthesis.speak(msg);
}

// INIT
window.onload = function () {
  const elements = document.getElementsByClassName("typewrite");
  for (let i = 0; i < elements.length; i++) {
    const words = JSON.parse(elements[i].getAttribute("data-type"));
    const period = elements[i].getAttribute("data-period");
    new TypeWriter(elements[i], words, period);
  }
};
</script>
{% endblock %}
